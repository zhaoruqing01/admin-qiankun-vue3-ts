import vue from '@vitejs/plugin-vue';
import { resolve } from 'path';
import { defineConfig } from 'vite';

// https://vitejs.dev/config/
export default defineConfig({
  // 1. åŸºç¡€è·¯å¾„é…ç½®ï¼ˆä¸»åº”ç”¨ç‹¬ç«‹è¿è¡Œæ—¶çš„æ ¹è·¯å¾„ï¼Œé»˜è®¤ '/'ï¼Œéƒ¨ç½²æ—¶éœ€æ ¹æ®å®é™…åŸŸåè·¯å¾„è°ƒæ•´ï¼‰
  base: '/',

  // 2. æ’ä»¶é…ç½®ï¼ˆVue é¡¹ç›®æ ¸å¿ƒæ’ä»¶ï¼ŒReact é¡¹ç›®æ›¿æ¢ä¸º @vitejs/plugin-reactï¼‰
  plugins: [vue()],

  // 3. è§£æé…ç½®ï¼ˆç®€åŒ–è·¯å¾„å¼•ç”¨ï¼‰
  resolve: {
    // è·¯å¾„åˆ«åï¼š@ æŒ‡å‘ src ç›®å½•ï¼Œé¿å…ç›¸å¯¹è·¯å¾„å±‚çº§æ··ä¹±
    alias: {
      '@': resolve(__dirname, 'src'),
    },
    // çœç•¥æ–‡ä»¶åç¼€ï¼ˆå¯¼å…¥æ—¶å¯çœç•¥ .vue/.js/.ts ç­‰ï¼‰
    extensions: ['.mjs', '.js', '.ts', '.jsx', '.tsx', '.json', '.vue'],
  },

  // 4. å¼€å‘æœåŠ¡å™¨é…ç½®ï¼ˆæ ¸å¿ƒï¼šå…è®¸å­åº”ç”¨è·¨åŸŸè¯·æ±‚ï¼‰
  server: {
    // ä¸»åº”ç”¨è¿è¡Œç«¯å£ï¼ˆé¿å…ä¸å­åº”ç”¨å†²çªï¼Œå¦‚ 8080ï¼‰
    port: 8080,
    // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    open: true,
    // å…è®¸å±€åŸŸç½‘è®¿é—®ï¼ˆæ–¹ä¾¿å…¶ä»–è®¾å¤‡è°ƒè¯•ï¼‰
    host: '0.0.0.0',

    // ğŸŒŸ å…³é”®é…ç½®ï¼šè·¨åŸŸå…è®¸ï¼ˆå­åº”ç”¨è¿è¡Œåœ¨ä¸åŒç«¯å£ï¼Œä¸»åº”ç”¨éœ€å…è®¸è·¨åŸŸè¯·æ±‚ï¼‰
    cors: true, // ç­‰ä»·äºå…è®¸æ‰€æœ‰è·¨åŸŸè¯·æ±‚ï¼ˆå¼€å‘ç¯å¢ƒå®‰å…¨ï¼‰

    // å¯é€‰ï¼šæ›´ç²¾ç»†çš„è·¨åŸŸé…ç½®ï¼ˆå¦‚éœ€é™åˆ¶å…è®¸çš„å­åº”ç”¨åŸŸåï¼‰
    // cors: {
    //   origin: ['http://localhost:8081', 'http://localhost:8082'], // å…è®¸çš„å­åº”ç”¨åŸŸå+ç«¯å£
    //   methods: ['GET', 'POST', 'OPTIONS'], // å…è®¸çš„è¯·æ±‚æ–¹æ³•
    //   credentials: true, // å…è®¸æºå¸¦ Cookieï¼ˆå¦‚éœ€å…±äº«ç™»å½•æ€ï¼‰
    // },

    // å¯é€‰ï¼šä»£ç†é…ç½®ï¼ˆå¦‚æœä¸»åº”ç”¨éœ€è¦è½¬å‘è¯·æ±‚åˆ°åç«¯ï¼Œé¿å…è·¨åŸŸï¼‰
    proxy: {
      '/api': {
        target: 'http://localhost:3000', // åç«¯æ¥å£åœ°å€
        changeOrigin: true, // è·¨åŸŸæ—¶ä¿®æ”¹ Origin å¤´
        rewrite: (path) => path.replace(/^\/api/, ''), // å»æ‰è¯·æ±‚è·¯å¾„ä¸­çš„ /api å‰ç¼€
      },
    },
  },

  // 5. æ„å»ºé…ç½®ï¼ˆä¼˜åŒ–ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…ï¼‰
  build: {
    // æ‰“åŒ…ç›®æ ‡æµè§ˆå™¨ï¼ˆæ ¹æ®é¡¹ç›®éœ€æ±‚è°ƒæ•´ï¼Œæ”¯æŒ ES2015+ï¼‰
    target: 'es2015',
    // è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ distï¼Œå¯æ ¹æ®éƒ¨ç½²éœ€æ±‚ä¿®æ”¹ï¼‰
    outDir: 'dist',
    // é™æ€èµ„æºç›®å½•ï¼ˆé»˜è®¤ assetsï¼Œæ‰“åŒ…åä¼šå°†é™æ€èµ„æºæ”¾å…¥è¯¥æ–‡ä»¶å¤¹ï¼‰
    assetsDir: 'assets',
    // å‹ç¼©é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒé»˜è®¤å¼€å¯ï¼Œç§»é™¤ console å’Œ debuggerï¼‰
    minify: 'terser',
  },

  // 6. CSS é…ç½®ï¼ˆå¯é€‰ï¼Œæ ¹æ®é¡¹ç›®æ ·å¼æ–¹æ¡ˆè°ƒæ•´ï¼‰
  css: {
    preprocessorOptions: {
      // å¦‚ä½¿ç”¨ scssï¼Œå¯å…¨å±€æ³¨å…¥å˜é‡/æ··åˆå™¨
      scss: {
        additionalData: `@import "@/styles/variables.scss";`,
      },
    },
  },
});
